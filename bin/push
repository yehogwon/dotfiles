#! /bin/bash

CWD=$(pwd)

SCRIPT_PATH="$(realpath "${BASH_SOURCE[0]:-$0}")"
SCRIPT_DIR="$(dirname "$SCRIPT_PATH")"
DOTFILES_DIR="$(realpath "$SCRIPT_DIR/..")" # does not end with a slash

function restore_return() {
    cd "$CWD"
    return $1
}

echo "Updating submodules..."
cd "$DOTFILES_DIR"
git submodule update --remote

echo "Adding dotfiles to GitHub and committing..."
if git add .; then
    echo "Dotfiles added successfully."
else
    echo "Failed to add dotfiles."
    restore_return 1
fi

if git commit -m "$(date +"%Y.%m.%d-%H:%M:%S") ~ Dotfiles Pushed ðŸš€"; then
    echo "Dotfiles committed successfully."
else
    echo "Failed to commit dotfiles."
    restore_return 1
fi

if git push origin main; then
    echo "Dotfiles pushed successfully."
else
    echo "Failed to push dotfiles."
    restore_return 1
fi

restore_return 0
